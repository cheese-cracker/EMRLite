<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>{{ title }}</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:400,700"
    />
    <!-- https://fonts.google.com/specimen/Open+Sans -->
    <link rel="stylesheet" href="{% static 'css/fontawesome.min.css' %}">
    <!-- https://fontawesome.com/ -->
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="{% static 'css/templatemo-style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/jquery.dataTables.min.css' %}">
    <link type="text/css" href="{% static 'css/dataTables.checkboxes.css' %}" rel="stylesheet" />
    <!--
	Product Admin CSS Template
	https://templatemo.com/tm-524-product-admin
	-->
  </head>

  <body>
    <div>
      <nav class="navbar navbar-expand-xl">
        <div class="container h-100">
          <a class="navbar-brand" href="index.html">
            <h1 class="tm-site-title mb-0">EMRLite System</h1>
          </a>
          <button
            class="navbar-toggler ml-auto mr-0"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <i class="fas fa-bars tm-nav-icon"></i>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mx-auto h-100">
              <li class="nav-item">
                <a class="nav-link" href="index.html">
                  <i class="fas fa-tachometer-alt"></i> Dashboard
                  <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <i class="far fa-file-alt"></i>
                  <span> Reports <i class="fas fa-angle-down"></i> </span>
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="#">Daily Report</a>
                  <a class="dropdown-item" href="#">Weekly Report</a>
                  <a class="dropdown-item" href="#">Yearly Report</a>
                </div>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="products.html">
                  <i class="fas fa-shopping-cart"></i> Products
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="accounts.html">
                  <i class="far fa-user"></i> Accounts
                </a>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="navbarDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <i class="fas fa-cog"></i>
                  <span> Settings <i class="fas fa-angle-down"></i> </span>
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="#">Profile</a>
                  <a class="dropdown-item" href="#">Billing</a>
                  <a class="dropdown-item" href="#">Customize</a>
                </div>
              </li>
            </ul>
            <ul class="navbar-nav">
              <li class="nav-item">
                <button
                  class="btn btn-info text-uppercase"
                    >
                    <a class="nav-link d-block" href="/main/logout">
                    LOGOUT
                </button>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>

    <div class="col-12 tm-block-col">
        <div class="tm-bg-primary-dark tm-block-tallest tm-block-scroll">
            <h2 class="tm-block-title">Bill Cart - {{ patient }}</h2>
            <table id="items" class="display dataTable dt-checkboxes-select" cellspacing="0" width="100%">
              <thead>
                <tr>
                  <th></th>
                  <th>ID No.</th>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Cost</th>

                </tr>
              </thead>
              <tbody>
                {% for item in item_list %}
                <tr>
                  <td>{{ item.id }}</td>
                  <td>{{ item.id }}</td>
                  <td>{{ item.name }}</td>
                  <td>{{ item.category }}</td>
                  <td>{{ item.cost }}</td>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot>
                <tr>
                  <th></th>
                  <th>ID No.</th>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Cost</th>
                </tr>
              </tfoot>
            </table>
        </div>
    </div>
    <div class="col-12">
        <div class="tm-bg-primary-dark tm-mt-small row">
            <input type="hidden" id="csrftok" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
            <button
              id="formulator"
              onclick="requestator()"
              type="submit"
              class="btn btn-primary text-uppercase"
            >
             Save Bill
            </button>
        </div>
    </div>

    <footer class="tm-footer row tm-mt-small">
      <div class="col-12 font-weight-light">
        <p class="text-center text-white mb-0 px-4 small">
          Copyright &copy; <b>2018</b> All rights reserved.

          Design: <a rel="nofollow noopener" href="https://templatemo.com" class="tm-footer-link">Template Mo</a>
        </p>
<p><b>Selected rows data:</b></p>
<pre id="example-console-rows"></pre>
      </div>
    </footer>
    <script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
    <!-- https://jquery.com/download/ -->
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- https://getbootstrap.com/ -->
    <script type="text/javascript" charset="utf8" src="{% static 'js/dataTables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dataTables.checkboxes.min.js' %}"></script>

<script>
$(document).ready(function (){

var table = $('#items').DataTable({
  'columnDefs': [
     {
        'targets': 0,
        'checkboxes': {
           'selectRow': true
        }
     }
  ],
  'select': {
     'style': 'multi'
  },
  'stateSave':true,
  'order': [[1, 'asc']]
});

console.log('yay!');

// Handle form submission event
// var submitter = document.getElementById('formulator');
requestator = function(event){

    var rows_selected = table.column(0).checkboxes.selected();
    var token_csrf = document.getElementById('csrftok').value;
    console.log(token_csrf);

    var rows = [];
    $.each(rows_selected, function(index, rowId){
        rows.push(rowId);
        console.log(rows);
    });

    fetch("/main/generatebill", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": token_csrf,
        },
        body: JSON.stringify({
            "selected": rows,
        }),
    })
        .then( (res) => res.json())
        .then( (res) => JSON.stringify(res))
        .then( (res) => {
            console.log('Recieved\n');
            console.log(res);
            console.log(res['message']);
        })
        .then( (res) => {
            window.location.pathname = '/main/billing';
        })
        .catch( (err) => console.log(err));
}

});
</script>
  </body>
</html>
